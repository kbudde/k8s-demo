#@ load("@ytt:data", "data")
#@ domain = data.values.shared.domain
#@ frontend = "auth." + domain
#@ admin =  "keycloak." + domain
---
apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: keycloak
spec:
  db:
    vendor: postgres
    url: jdbc:postgresql://keycloak-psql-rw.keycloak:5432/app
    usernameSecret:
      name: keycloak-psql-app
      key: user
    passwordSecret:
      name: keycloak-psql-app
      key: password
  hostname:
    admin: #@ admin
    hostname: #@ frontend
  bootstrapAdmin:
    service:
      secret: keycloak-bootstrap
    user:
      secret: keycloak-bootstrap
  instances: 2

---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-bootstrap
stringData:
  username: <path:static/bootstrap.yaml#username>
  password: <path:static/bootstrap.yaml#password>
  client-id: <path:static/bootstrap.yaml#client-id>
  client-secret: <path:static/bootstrap.yaml#client-secret>
