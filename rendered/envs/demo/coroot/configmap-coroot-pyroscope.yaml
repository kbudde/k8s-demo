apiVersion: v1
data:
  config.yaml: |
    log-level: debug
    retention: 8h
    retention-levels:
      "0": 1h
      "1": 4h
      "2": 8h
    scrape-configs:
    - enabled-profiles:
      - cpu
      - mem
      job-name: kubernetes-pods
      kubernetes-sd-configs:
      - role: pod
      relabel-configs:
      - action: keep
        regex: true
        source-labels:
        - __meta_kubernetes_pod_annotation_pyroscope_io_scrape
      - action: replace
        source-labels:
        - __meta_kubernetes_pod_annotation_pyroscope_io_application_name
        target-label: __name__
      - action: replace
        regex: (https?)
        source-labels:
        - __meta_kubernetes_pod_annotation_pyroscope_io_scheme
        target-label: __scheme__
      - action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        source-labels:
        - __address__
        - __meta_kubernetes_pod_annotation_pyroscope_io_port
        target-label: __address__
      - action: labelmap
        regex: __meta_kubernetes_pod_label_(.+)
      - action: replace
        source-labels:
        - __meta_kubernetes_namespace
        target-label: namespace
      - action: replace
        source-labels:
        - __meta_kubernetes_pod_name
        target-label: pod
      - action: drop
        regex: Pending|Succeeded|Failed|Completed
        source-labels:
        - __meta_kubernetes_pod_phase
      - action: labelmap
        regex: __meta_kubernetes_pod_annotation_pyroscope_io_profile_(.+)
        replacement: __profile_$1
kind: ConfigMap
metadata:
  annotations:
    a8r.io/repository: https://github.com/kbudde/k8s-demo
  labels:
    app.kubernetes.io/instance: coroot
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: pyroscope
    app.kubernetes.io/version: 0.37.2
    helm.sh/chart: pyroscope-0.2.92
  name: coroot-pyroscope
